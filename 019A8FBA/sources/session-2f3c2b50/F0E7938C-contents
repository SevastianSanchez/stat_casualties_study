---
title: "Preliminary Exploratory Analysis of DI and SPI/SDG Relationship"
author: "Sevastian Sanchez"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: no
    toc_depth: '3'
    number_sections: yes
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
    number_sections: yes
    highlight: tango
    theme: default
    fig_caption: yes
    df_print: tibble
---

## Setup 
```{r}
#load libraries/packages
source("packages.R")

# load data
source("Comp2_panel_wrangling.R")
panel_data1 <- panel_data %>% 
  dplyr::select(country_name, country_code, year, spi_comp, di_score, log_gdppc, sdg_overall, income_level_recoded) %>%
  dplyr::arrange(country_code, year)

# how many countries 
length(unique(panel_data1$country_code)) 

# check dimensions
dim(panel_data1) 
```

## Scatterplots: DI vs SPI & SDG Composite Scores
```{r}
# Contemporaneous Relationship: SPI ~ DI
spi_di_scatter <- ggplot(panel_data1, aes(x = di_score, y = spi_comp)) + 
  geom_point(color = "steelblue4", size = 1, alpha = 0.65) +
  geom_smooth(method = "lm", 
              se = TRUE, color = "darkblue", size = 1) +
  labs(
    title = "Higher Democracy → Higher SPI",
    x = "Democracy Index (0-10 Scale)",
    y = "SPI Composite (0-100 Scale)"
  ) +
  theme_minimal()+
  theme(plot.title = element_text(size = 16, face = "bold")) +
  ylim(20, 100)

# Save to specific folder
#ggsave("figures/spi_di_scatterplot.png", spi_di_scatter, width = 6, height = 8)

# Contemporaneous Relationship: SDG ~ DI
sdg_di_scatter <- ggplot(panel_data1, aes(x = di_score, y = sdg_overall)) + 
  geom_point(color = "steelblue4", size = 1, alpha = 0.65) +
  geom_smooth(method = "lm", 
              se = TRUE, color = "#f27405", size = 1) +
  labs(
    title = "Higher Democracy → Higher SDG Score",
    x = "Democracy Index (0-10 Scale) ",
    y = "SDG Composite (0-100 Scale)"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(size = 16, face = "bold")) +
  ylim(39, 90)

# Save to specific folder
#ggsave("figures/sdg_di_scatterplot.png", sdg_di_scatter, width = 6, height = 8)

#  Combine bw plots 
combined_scatter <- spi_di_scatter + sdg_di_scatter +
  plot_annotation(title = "Democracy & Main Dependent Variables: SPI & SDG Scores",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 18),
      plot.margin = margin(t = 10, r = 10, b = 10, l = 10)
    )) &
  theme(
    plot.margin = margin(5, 5, 5, 5),  # inner margins around each subplot
    legend.position = "bottom",              
    legend.title = element_blank()
  )
  combined_scatter
  
# Save bw version 
ggsave("figures/combined_scatter.png", 
       plot = combined_scatter, 
       width = 12, height = 8)
```

## Creating + saving black and white version
```{r}
spi_di_scatter_bw <- spi_di_scatter +
  geom_point(color = "grey35", size = 1, alpha = 0.35) +
  geom_smooth(method = "lm", se = TRUE, color = "grey20", size = 1)

sdg_di_scatter_bw <- sdg_di_scatter +
  geom_point(color = "grey35", size = 1, alpha = 0.35) +
  geom_smooth(method = "lm", se = TRUE, color = "grey20", size = 1)

#  Combine bw plots 
combined_scatterplot_bw <- spi_di_scatter_bw + sdg_di_scatter_bw +
  plot_annotation(title = "Democracy & Main Dependent Variables: SPI & SDG Scores",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 18),
      plot.margin = margin(t = 10, r = 10, b = 10, l = 10)
    )
  ) &
  theme(
    plot.margin = margin(5, 5, 5, 5)  # inner margins around each subplot
  )
combined_scatterplot_bw

# Save bw version 
ggsave("figures/combined_scatter_bw.png", 
       plot = combined_scatterplot_bw, 
       width = 12, height = 8)
```


## NAIVE OLS Models: DI variable on SPI & SDG Performance 
Finding estimated impact of DI on SPI and SDG status prior to adding controls or robust SEs
```{r}
# 1. OLS for SPI and DI - Overall
ols_spi_di_naive <- lm(spi_comp ~ di_score, data = merged)
summary(ols_spi_di_naive)

# 2. OLS for SDG and DI - Overall
ols_sdg_di_naive <- lm(sdg_overall ~ di_score, data = merged)
summary(ols_sdg_di_naive)

# stargazer summary table of models: ols_spi_di_naive, ols_sdg_di_naive.
stargazer(
  ols_spi_di_naive, 
  ols_sdg_di_naive, 
  title = "Naive OLS Models: DI & SPI/SDG",
  dep.var.caption = "Dependent Variable:",
  dep.var.labels = c("SDG Composite Score", "SPI Composite Score"),
  #covariate.labels = c("di_score", "Intercept"),
  #column.labels = c("SPI Only", "SCI Only", "SPI + SCI"),  # <-- Model labels at the top
  omit.stat = c("f", "ser"), 
  digits = 4,
  type = "text"
  #out = "component_1/figures/naive_mods_sdgs&spi_di_tab.html"  # Save as HTML file
)

```
*results*
ols_spi_di_naive: 5.0122 (p-value < 0.001)
ols_sdg_di_naive: 3.22301 (p-value < 0.001)

The naive OLS models indicate that the Democracy Index (DI) has a strong positive relationship with both the Statistical Performance Index (SPI) and the Sustainable Development Goals (SDG) composite scores. The coefficients suggest that a one-unit increase in DI is associated with a 5.0122 increase in SPI and a 3.22301 increase in SDG scores, both statistically significant at p < 0.001. This suggests that countries with higher democracy scores tend to have better statistical performance and SDG outcomes.

## Checking for Heteroskedasticity: residual plots [no need to report]
```{r}
plot(ols_spi_di_naive, which = 1)  # SPI ~ DI model 
plot(ols_sdg_di_naive, which = 1)  # SDG ~ DI model 
```

```{r}
# Contemporaneous Relationship: SDG ~ SPI
sdg_spi_s2_scatter <- ggplot(panel_data1, aes(x = spi_comp, y = sdg_overall)) + 
  geom_point(color = "steelblue4", size = 1, alpha = 0.65) +
  geom_smooth(method = "lm", 
              se = TRUE, color = "darkgreen", size = 1) +
  labs(
    title = "Effect of Statistical Capacity on SDG Performance",
    x = "SPI Composite (0-100 Scale)",
    y = "SDG Composite (0-100 Scale)"
  ) +
  theme(plot.title = element_text(size = 14))+
  theme_minimal()

# Contemporaneous Relationship: SDG ~ DI
sdg_di_s2_scatter <- ggplot(panel_data1, aes(x = di_score, y = sdg_overall)) + 
  geom_point(color = "steelblue4", size = 1, alpha = 0.65) +
  geom_smooth(method = "lm", 
              se = TRUE, color = "#f27405", size = 1) +
  labs(
    title = "Effect of Democracy Levels on SDG Performance",
    x = "DI Composite (0-10 Scale)",
    y = "SDG Composite (0-100 Scale)"
  ) +
  theme(plot.title = element_text(size = 14))+
  theme_minimal()

# side by side comparison using patchwork 
library(patchwork)
sdg_spi_s2_scatter + sdg_di_s2_scatter + plot_layout(ncol = 2)
#ggsave("component_2/figures/stage2/s2_scatterplots.png", width = 12, height = 8)
```

